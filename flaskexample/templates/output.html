<!DOCTYPE html>
<html lang="en">
  <head> 
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>CourseXray</title>

    <!-- Bootstrap core CSS -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="starter-template.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
<style>
       

    svg {
        width: 150%;
        height: 200%;
        position: center;
    }

    .toolTip {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        position: absolute;
        display: none;
        width: auto;
        height: auto;
        background: none repeat scroll 0 0 white;
        border: 0 none;
        border-radius: 8px 8px 8px 8px;
        box-shadow: -3px 3px 15px #888888;
        color: black;
        font: 12px sans-serif;
        padding: 5px;
        text-align: center;
    }

    text {
        font: 18px sans-serif;
        color: white;
    }

   /*text.value {
        font-size: 140%;
        fill: white;
    }*/

    .axisHorizontal path{
        fill: none;
    }

    .axisHorizontal .tick line {
        stroke-width: 1;
        stroke: rgba(0., 0, 0, 0.2);
    }

    .bar rect {
        fill: steelblue;
        fill-opacity: .9;
    }


</style>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/input">CourseXray</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li ><a href="/input">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
<div class="container">

    <div class="starter-template">
        <br><br>
  <br>
   <div class="col-md-3 col-md-offset-2"></div>
   <img id="im1" src="{{ url_for('static', filename='x-ray-clipart-Xrayspec.jpg') }}" width="100" alt="Example Visualization"/>


  </div>


<!-- <a href="static/stupid_img.png">link text</a>-->

        <h2>CourseXray </h2>
        <p class="lead">Want different courses? Try a new search!</p>
    </div>

    

   


    <div class = "container" class='col-12'>

      <form  action="/output" method="GET">
       <div class="form-group" class='col-12' > 
          <label for="user_keyword">Enter Keywords:</label><br>
          <input  type="text"  class="col-12" id="user_keyword" name='user_keyword' placeholder="e.g. introductory, advanced">
        </div>
        <div>
          <button type="submit" class="btn btn-primary btn-lg">Find Your Class!</button>
        </div>
      </form>
    </div>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="static/js/bootstrap.js"></script>

  </div> <!-- /.container-->

<br>

     </div><!-- /.container -->

    <div class="container">
      <div class="starter-template">
        <h3> Hello!</h3>
        <p class="lead">You are interested in "{{the_result}}"</p>
      </div>


      <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
      <script src="static/js/bootstrap.min.js"></script>


     </div><!-- /.container -->



    <div class="container">
      <div class="starter-template">
        <h3>Your Course Results:</h3>


        <p class="lead">Here are the courses where reviewers were talking about your keywords the most often! <br> Check out the Xray for the top class.  Your next best courses are below! </p>
      </div>


      
      <table class="table table-hover">
      <tr><th>Course</th><th>Description</th><th>Number of Reviews</th><th>Offered by</th> <th></th></tr>
      {% for x in  c1 %}
      <tr><td><a href={{x['url']}}>{{ x['coursename']}}</td>
        <td>{{ x['description'] }}  <a href={{x['url']}}> ...More Here! </td>
        <td> {{ x['number'] }}</td>
        <td> {{ x['company'] }}</td>     
      </tr>
      {% endfor %}
      </table>


<br>
<br>
<br>
<p class="lead"> This is how students in your best matching course feel about your top keyword, "<b>{{keyword}}</b>." Use the Xray to find out how reviewers feel about any other topic (e.g. homework, instructor, math, explanations)!   </p>
    <div class = "container">

      <form  action="/output_xray" method="GET">
        <div class="form-group"> 
          <label for="user_keyword2"> </label>
          <input type="text" class="input-lg" id="user_keyword2" name='user_keyword2' placeholder="New topic! ">
        </div>
        <div>
          <button type="submit" class="btn btn-primary btn-lg">Xray!</button>
        </div>
      </form>
    </div>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>

<br>
<br>


 <div class="container">
  <table>
<tr><th> <div id="stacked-bar"> </div> </th>   
 <th> <div id='hist_sent'></div>    </th></tr>
 </table>
</div>
<!-- <div id='stacked-bar' >  </div>
<div id='hist_sent'></div> -->

<br>
<br>


<br>


      <table class="table table-hover">
      <tr><th>Course</th><th>Description</th><th>Number of Reviews</th><th>Offered by</th> </tr>
      {% for course in  courses %}
      <tr><td><a href={{course['url']}}>{{ course['coursename']}}</td>
        <td>{{ course['description'] }}  <a href={{course['url']}}> ...More Here! </td>
        <td> {{ course['number'] }}</td>
        <td> {{ course['company'] }}</td>   




      </tr>
      {% endfor %}
      </table>








    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
  <script src="static/js/bootstrap.min.js"></script>





<script src="//d3js.org/d3.v4.min.js"></script>
<script>
var initStackedBarChart = {
  draw: function(config) {
    me = this,
    domEle = config.element,
    stackKey = config.key,
    data = config.data,
    margin = {top: 30, right: 180, bottom: 50, left: 9},
    width = 700 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom,
    xScale = d3.scaleLinear().rangeRound([0, width]),
    yScale = d3.scaleBand().rangeRound([height, 0]).padding(0.1),
    color = d3.scaleOrdinal(d3.schemeCategory20),

    xAxis = d3.axisBottom(xScale).ticks(5),
    yAxis =  d3.axisLeft(yScale),
    svg = d3.select("#"+domEle).append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var stack = d3.stack()
      .keys(stackKey)
      /*.order(d3.stackOrder)*/
      .offset(d3.stackOffsetNone);
  
    var layers= stack(data);
      data.sort(function(a, b) { return b.total - a.total; });
      yScale.domain(data.map(function(d) { return (d.word); }));
      xScale.domain([0, d3.max(layers[layers.length - 1], function(d) { return d[0] + d[1]; }) ]).nice();
    var tooltip = d3.select("body").append("div").attr("class", "toolTip");


    var layer = svg.selectAll(".layer")
      .data(layers)
      .enter().append("g")
      .attr("class", "layer")
      .style("fill", function(d, i) { return color(i); });
      layer.selectAll("rect")
        .data(function(d) { return d; })
      .enter().append("rect")
        .attr("y", function(d) { return yScale((d.data.word)); })
        .attr("x", function(d) { return xScale(d[0]); })
        .attr("height", yScale.bandwidth())
        .attr("width", function(d) { return xScale(d[1]) - xScale(d[0]) })
    .on("mousemove", function(d){
            tooltip
              .style("left", d3.event.pageX - 50 + "px")
              .style("top", d3.event.pageY - 70 + "px")
              .style("display", "inline-block")
              .html( "Keyword: " + (d.data.word)+"<br>"+"Review: "+ d3.format(".2f")(d.data.review) + "<br>"  + "Description: "+d3.format(".2f")(d.data.description));
              })
        .on("mouseout", function(d){ tooltip.style("display", "none");});


      svg.append("text")      // text label for the x axis
        .attr("x", width/2. )
        .attr("y",  1.25*height )
        .style("text-anchor", "middle")
        .text("Score");


       svg.append("text")      // text label for the x axis
        .attr("x", 0.4*width)
        .attr("y",  0.15*height )
        .style("text-anchor", "middle")
        .style("fill", "LightSteelBlue")
        .text("Descriptions");



 
      svg.append("text")      // text label for the x axis
        .attr("x", 0.1*width)
        .attr("y",  0.15*height )
        .style("text-anchor", "middle")
        .style("fill", "SteelBlue")
        .text("Reviews");



      svg.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + (height) + ")")
      .call(xAxis);
     
  svg.append("g")
      .attr("class", "axis axis--y")
      .attr("transform", "translate(0,0)")
    //.style("text-anchor", "start")
      //.attr("transform", function(d) {
       //         return "rotate(-65)" 
        //        })
      .call(yAxis);    



      svg.append("g")
      .attr("class", "axis axis--y")
      .attr("transform", "translate(" + (width) + ",0)")
    //.style("text-anchor", "start")
      //.attr("transform", function(d) {
       //         return "rotate(-65)" 
        //        })
      .call(yAxis);    



     svg.append("g")
    .attr("transform", "translate(" + (width/5) + ", -15)")
    .append("text")
    .text("Where your keywords occurred:")
    .style({"text-anchor":"middle", "font-family":"Arial", "font-weight":"800"});




  }
}


 

var data = [
{"word":"{{power[0]['word'] }}","review":{{power[0]['rev_pow'] }},"description":{{power[0]['des_pow'] }}},
{"word":"{{power[1]['word'] }}","review":{{power[1]['rev_pow'] }},"description":{{power[1]['des_pow'] }}},
{"word":"{{power[2]['word'] }}","review":{{power[2]['rev_pow'] }},"description":{{power[2]['des_pow'] }}},
{"word":"{{power[3]['word'] }}","review":{{power[3]['rev_pow'] }},"description":{{power[3]['des_pow'] }}},
{"word":"{{power[4]['word'] }}","review":{{power[4]['rev_pow'] }},"description":{{power[4]['des_pow'] }}},
];
var key = ["review", "description"];




initStackedBarChart.draw({
  data: data,
  key: key,
  element: 'stacked-bar'
});

 
var inithistChart = {
  draw: function(config) {
    domEle = config.element,
    data = config.data,
    margin = {top: 30, right: 100, bottom: 50, left: 80},
    width = 660 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom,

    svg = d3.select("#"+domEle).append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


    var formatCount = d3.format(",.0f");

    var x = d3.scaleLinear()
    .rangeRound([0, width]).domain([-0.5,1]);


    /*var x = d3.scaleLinear()
    .domain([-0.5, 1])
    .range([0, width]);Â */

    var bins = d3.histogram()
      .domain(x.domain())
      .thresholds(x.ticks(15))
      (data);


  var y = d3.scaleLinear()
    .domain([0, d3.max(bins, function(d) { return d.length; })])
    .range([height, 0]);


  var bar = svg.selectAll(".bar")
    .data(bins)
    .enter().append("g")
    .attr("class", "bar")
    .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; });

    bar.append("rect")
    .attr("x", 1)
    .attr("width", x(bins[0].x1) - x(bins[0].x0) - 1.)
    .attr("height", function(d) { return height - y(d.length); });


      svg.append("text")      // text label for the x axis
        .attr("x", width/6. )
        .attr("y",  1.25*height )
          .attr("font-size", "20px")

        .style("text-anchor", "middle")
        .text("Less Happy");


      svg.append("text")      // text label for the x axis
        .attr("x", 0.9*width )
        .attr("y",  1.25*height )
                .attr("font-size", "20px")
        .style("text-anchor", "middle")
        .text("More Happy");

      svg.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")

      .call(d3.axisBottom(x));
    

     svg.append("g")
    .attr("transform", "translate(" + (width/15) + ", -15)")
    .append("text")
            .attr("font-size", "18px")

    .text("How happy students are about your keyword:  {{keyword}}")
    .style({"text-anchor":"middle", "font-family":"Arial", "font-weight":"0"});



  }
}

var dhist ={{dhist}};
/*var dhist=[0.51,0.71,0.72]*/
inithistChart.draw({
  data: dhist,
  element: 'hist_sent'
});






</script>


  </body>



</html>